var mongoose = require('mongoose');
var schTurn = new mongoose.Schema({
    turnDate: Date,
    participants: [{userid: mongoose.Schema.Types.ObjectId, 
                    weapon: {type: String, enum: 'Rock,Scissors,Paper'.split(',')}}]
});
var modTurn = mongoose.model('turn', schTurn);


//************************************************************************************************************
// function     : d4-roshamturn.takeTurn
// developer    : Kai
// developed on : 5/19/2014
// arguments    : turn object {userid, weapon}
//                callback function (error, user._id)
//************************************************************************************************************
exports.takeTurn = function(turn, callback){
    if(!turn){
        return callback({'error': 'What turn you talkin bout?'}, undefined);
    }
    if (!turn.userid){
        return callback({'error': 'Who is taking this turn anyway?'}, undefined);
    }

    var user = require('d4-user');
    user.validateUser({'_id':turn.userid}, function(err, found){
        if (err){
            return callback({'error': err}, undefined);
        }
        if (found){
            var query = modTurn.findOne().where('turnDate').equals(undefined);
            query.exec(function(err, curTurn){
                if(err){
                    return callback({'error': err}, undefined);
                }
                if(curTurn){
                    
                }
                else{
                    var newTurn = new modTurn();
                }
                
                return callback(undefined, 'working up to here');
            });
        }
        else{
            return callback({'error': 'Who is taking this turn anyway?'}, undefined);
        }
    });    
}